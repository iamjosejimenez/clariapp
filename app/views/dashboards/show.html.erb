<%= render ModuleHeaderComponent.new(
  title: "Inversiones",
  description: "Revisa tu total disponible y el estado de tus metas para seguir tu avance en un solo lugar."
) do %>
  <% if @external_account.present? %>
    <section class="bg-white shadow-sm rounded-2xl p-6 sm:p-8 border border-slate-200 min-h-[calc(100vh-16rem)]">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-start gap-4 sm:gap-3 mb-6">
        <h2 class="text-2xl font-semibold text-slate-900">Tus metas</h2>
        <p class="inline-flex items-center px-3 py-1 bg-white border border-violet-700 text-violet-700 text-sm font-medium rounded-xl whitespace-nowrap">
          Total: <%= clp(@total_available) %>
        </p>
      </div>
      <% if @goals.any? %>
        <%= render TableComponent.new(rows: @goals) do |table| %>
            <% table.with_column(name: "Meta", classes: "text-left font-medium text-gray-900") do |goal| %>
              <%= goal.name %>
            <% end %>

            <% table.with_column(name: "Total", classes: "text-left text-gray-700") do |goal| %>
              <%= clp(goal.nav.to_f) %>
            <% end %>

            <% table.with_column(name: "Rentabilidad", classes: "text-left text-gray-700") do |goal| %>
              <%= clp(goal.profit.to_f) %>
            <% end %>

            <% table.with_column(name: "Acciones", classes: "text-left text-gray-700") do |goal| %>
              <div class="flex items-center">
                <%= link_to goal_path(goal),
                    class: "inline-flex items-center justify-center rounded-full text-violet-700 hover:bg-violet-100 hover:text-violet-900 transition-colors duration-200 cursor-pointer",
                    data: { "tippy-content": "Ver detalle de la inversion" } do %>
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-4 w-4">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-4.35-4.35m0 0A7.5 7.5 0 1 0 6.05 6.05a7.5 7.5 0 0 0 10.6 10.6Z" />
                  </svg>
                <% end %>
              </div>
            <% end %>
          <% end %>
      <% else %>
        <p class="text-slate-600">No hay metas para mostrar.</p>
      <% end %>
    </section>
  <% else %>
    <section class="bg-white shadow-sm rounded-2xl p-6 sm:p-8 border border-slate-200 text-center min-h-[calc(100vh-16rem)]">
      <h2 class="text-2xl font-semibold text-slate-900 mb-4">Conecta tu cuenta</h2>
      <p class="text-slate-600 mb-6">Vincula tu cuenta de Fintual para ver tus inversiones.</p>
      <%= link_to "Conectar con Fintual", fintual_sessions_new_path, class: "inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-lg text-white bg-violet-700 hover:bg-violet-800 shadow-sm transition-colors duration-200" %>
    </section>
  <% end %>
<% end %>
